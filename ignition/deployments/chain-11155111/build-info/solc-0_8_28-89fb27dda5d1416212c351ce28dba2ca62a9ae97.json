{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-89fb27dda5d1416212c351ce28dba2ca62a9ae97",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/chainlink_permit2.sol": "project/contracts/chainlink_permit2.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/chainlink_permit2.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\n/// @notice Interfaz correcta de AllowanceTransfer (Permit2) según Uniswap\ninterface IAllowanceTransfer {\n    struct PermitDetails {\n        address token;\n        uint160 amount;\n        uint48 expiration;\n        uint48 nonce;\n    }\n\n    struct PermitSingle {\n        PermitDetails details;\n        address spender;\n        uint256 sigDeadline;\n    }\n\n    function permit(\n        address owner,\n        PermitSingle calldata permitSingle,\n        bytes calldata signature\n    ) external;\n\n    function transferFrom(\n        address from,\n        address to,\n        uint160 amount,\n        address token\n    ) external;\n}\n\n/// @notice Valida firmas Permit2 sin transferir tokens\ncontract Permit2TransferValidator {\n    /// @notice Dirección oficial de Permit2\n    IAllowanceTransfer public constant PERMIT2 =\n        IAllowanceTransfer(0x000000000022D473030F116dDEE9F6B43aC78BA3);\n\n    event PermitValidated(\n        address indexed owner,\n        address indexed token,\n        address indexed spender,\n        uint160 amount\n    );\n\n    event TokensTransferred(\n        address indexed from,\n        address indexed to,\n        address indexed token,\n        uint160 amount\n    );\n\n    /**\n     * @notice Valida la firma Permit2 sin transferir tokens\n     * @param permitSingle Datos del permiso (AllowanceTransfer)\n     * @param signature Firma EIP-712 del owner\n     * @param owner Dirección que firmó\n     */\n    function validatePermit(\n        IAllowanceTransfer.PermitSingle calldata permitSingle,\n        bytes calldata signature,\n        address owner\n    ) external {\n        // Llamada externa al contrato Permit2 desplegado (0x000000000022D473030F116dDEE9F6B43aC78BA3)\n        // La función permit() del contrato Permit2 valida la firma EIP-712, verifica nonce/expiración\n        // y registra el allowance. Si la firma es inválida, esta llamada revertirá.\n        PERMIT2.permit(owner, permitSingle, signature);\n\n        emit PermitValidated(\n            owner,\n            permitSingle.details.token,\n            permitSingle.spender,\n            permitSingle.details.amount\n        );\n    }\n\n    /**\n     * @notice Validates Permit2 signature and transfers tokens from owner to recipient\n     * @param permitSingle Permit data (AllowanceTransfer)\n     * @param signature EIP-712 signature from owner\n     * @param owner Address that signed\n     * @param recipient Address that will receive the tokens\n     * @param amount Amount to transfer (must be <= permitSingle.details.amount)\n     */\n    function validatePermitAndTransfer(\n        IAllowanceTransfer.PermitSingle calldata permitSingle,\n        bytes calldata signature,\n        address owner,\n        address recipient,\n        uint160 amount\n    ) external {\n        require(recipient != address(0), \"Invalid recipient\");\n        require(recipient != address(this), \"Cannot transfer to self\");\n        require(amount > 0, \"Zero amount\");\n        require(\n            amount <= permitSingle.details.amount,\n            \"Amount exceeds permitted\"\n        );\n        require(\n            permitSingle.details.token != address(0),\n            \"Invalid token\"\n        );\n        require(\n            permitSingle.spender == address(this),\n            \"Invalid spender\"\n        );\n\n        // 1. Validate signature via Permit2 (registers allowance if valid)\n        // Note: This will set/update the allowance in Permit2, but since we transfer\n        // immediately after, the allowance will be consumed and won't accumulate\n        PERMIT2.permit(owner, permitSingle, signature);\n\n        // 2. Transfer tokens from owner to recipient using Permit2\n        // This consumes from the allowance we just set, so it doesn't accumulate\n        PERMIT2.transferFrom(\n            owner,\n            recipient,\n            amount,\n            permitSingle.details.token\n        );\n\n        emit TokensTransferred(\n            owner,\n            recipient,\n            permitSingle.details.token,\n            amount\n        );\n    }\n}\n"
      }
    }
  }
}